<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE rfc [
  <!ENTITY nbsp    "&#160;">
  <!ENTITY zwsp   "&#8203;">
  <!ENTITY nbhy   "&#8209;">
  <!ENTITY wj     "&#8288;">
]>
<?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
<!-- generated by https://github.com/cabo/kramdown-rfc version 1.7.29 (Ruby 3.4.4) -->
<rfc xmlns:xi="http://www.w3.org/2001/XInclude" ipr="trust200902" docName="draft-mahy-mls-new-framed-content-tbs-00" category="info" consensus="true" submissionType="IETF" tocInclude="true" sortRefs="true" symRefs="true" version="3">
  <!-- xml2rfc v2v3 conversion 3.31.0 -->
  <front>
    <title abbrev="New MLS FramedContentTBS">A more efficient FramedContentTBS structure in Messsaging Layer Security (MLS)</title>
    <seriesInfo name="Internet-Draft" value="draft-mahy-mls-new-framed-content-tbs-00"/>
    <author fullname="Rohan Mahy">
      <organization/>
      <address>
        <email>rohan.ietf@gmail.com</email>
      </address>
    </author>
    <date year="2025" month="October" day="16"/>
    <area>Security</area>
    <workgroup>Messaging Layer Security</workgroup>
    <keyword>GroupContext hash</keyword>
    <keyword>FramedContent</keyword>
    <keyword>FramedContentTBS</keyword>
    <keyword>efficient signing</keyword>
    <keyword>deterministic signing</keyword>
    <abstract>
      <?line 40?>

<t>Most MLS signatures are signed over the relatively large GroupContext structure.
This document defines a way to safely sign using a pre-hashed version of the GroupContext structure for better efficiency.</t>
    </abstract>
    <note removeInRFC="true">
      <name>About This Document</name>
      <t>
        The latest revision of this draft can be found at <eref target="https://rohanmahy.github.io/mls-new-framed-content-tbs/draft-mahy-mls-new-framed-content-tbs.html"/>.
        Status information for this document may be found at <eref target="https://datatracker.ietf.org/doc/draft-mahy-mls-new-framed-content-tbs/"/>.
      </t>
      <t>
        Discussion of this document takes place on the
        Messaging Layer Security Working Group mailing list (<eref target="mailto:mls@ietf.org"/>),
        which is archived at <eref target="https://mailarchive.ietf.org/arch/browse/mls/"/>.
        Subscribe at <eref target="https://www.ietf.org/mailman/listinfo/mls/"/>.
      </t>
      <t>Source for this draft and an issue tracker can be found at
        <eref target="https://github.com/rohanmahy/mls-new-framed-content-tbs"/>.</t>
    </note>
  </front>
  <middle>
    <?line 45?>

<section anchor="introduction">
      <name>Introduction</name>
      <t>In MLS <xref target="RFC9420"/> all in-member application, commit, and proposal messages (whether sent via a PublicMessage, PrivateMessage or SemiPrivateMessage <xref target="I-D.mahy-mls-semiprivatemessage"/>); and all external commits contain a signature of the <tt>FramedContentTBS</tt> structure.
This structure contains the full GroupContext of the group, which can store a large amount of group state.
(For example, in the MIMI protocol <xref target="I-D.ietf-mimi-protocol"/> it contains the participant list for the group, which could contain thousands of URIs.)</t>
      <t>The GroupContext only changes once per epoch, therefore it is an excellent candidate to pre-hash and cache for efficiency reasons.</t>
      <t>This document defines an a replacement for the <tt>FramedContentTBS</tt> structure that uses a pre-hashed GroupContext, and an MLS extension for safely negotiating the use of the new struct.</t>
    </section>
    <section anchor="conventions-and-definitions">
      <name>Conventions and Definitions</name>
      <t>The key words "<bcp14>MUST</bcp14>", "<bcp14>MUST NOT</bcp14>", "<bcp14>REQUIRED</bcp14>", "<bcp14>SHALL</bcp14>", "<bcp14>SHALL
NOT</bcp14>", "<bcp14>SHOULD</bcp14>", "<bcp14>SHOULD NOT</bcp14>", "<bcp14>RECOMMENDED</bcp14>", "<bcp14>NOT RECOMMENDED</bcp14>",
"<bcp14>MAY</bcp14>", and "<bcp14>OPTIONAL</bcp14>" in this document are to be interpreted as
described in BCPÂ 14 <xref target="RFC2119"/> <xref target="RFC8174"/> when, and only when, they
appear in all capitals, as shown here.</t>
      <?line -18?>

</section>
    <section anchor="mechanism">
      <name>Mechanism</name>
      <t>This document defines the <tt>new_framed_content_tbs</tt> extension.
When present in a <tt>LeafNode.capabilities.extensions</tt> list, it indicates that the client supports this extension.
When present in the <tt>required_capabilities.extension_types</tt> list in <tt>GroupContext.extensions</tt> it indicates that every member of the group <bcp14>MUST</bcp14> use the new <tt>FramedContentTBS</tt> structure.</t>
      <t>The <tt>FramedContentTBS</tt> structure is replaced with the new structure below. The only change is that the GroupContext is replaced with a hash (from the group's current MLS cipher suite) of the GroupContext.</t>
      <sourcecode type="tls"><![CDATA[
context_hash = RefHash(GroupContext);

struct {
    ProtocolVersion version = mls10;
    WireFormat wire_format;
    FramedContent content;
    select (FramedContentTBS.content.sender.sender_type) {
        case member:
        case new_member_commit:
            opaque context_hash<V>;
        case external:
        case new_member_proposal:
            struct{};
    };
} FramedContentTBS;
]]></sourcecode>
    </section>
    <section anchor="security-considerations">
      <name>Security Considerations</name>
      <t>TODO Security</t>
    </section>
    <section anchor="iana-considerations">
      <name>IANA Considerations</name>
      <t>This document requests the addition of a new MLS Extension Type value under the heading of "Messaging Layer Security".</t>
      <t>RFC EDITOR: Please replace XXXX throughout with the RFC number assigned to this document.</t>
      <t>The <tt>new_framed_content_tbs</tt> MLS Extension Type is used inside LeafNode and GroupContext objects.
In a LeafNode it indicates support the the extension.
In the <tt>required_capabilities</tt> of the GroupContext it indicates the extension is being used.</t>
      <t>Value: 0x000b (suggested)</t>
      <t>Name: new_framed_content_tbs</t>
      <t>Message(s): GC,LN: This extension may appear in GroupContext and LeafNode objects</t>
      <t>Recommended: Y</t>
      <t>Reference: RFC XXXX</t>
    </section>
  </middle>
  <back>
    <references anchor="sec-combined-references">
      <name>References</name>
      <references anchor="sec-normative-references">
        <name>Normative References</name>
        <reference anchor="RFC9420" xml:base="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9420.xml">
          <front>
            <title>The Messaging Layer Security (MLS) Protocol</title>
            <author fullname="R. Barnes" initials="R." surname="Barnes"/>
            <author fullname="B. Beurdouche" initials="B." surname="Beurdouche"/>
            <author fullname="R. Robert" initials="R." surname="Robert"/>
            <author fullname="J. Millican" initials="J." surname="Millican"/>
            <author fullname="E. Omara" initials="E." surname="Omara"/>
            <author fullname="K. Cohn-Gordon" initials="K." surname="Cohn-Gordon"/>
            <date month="July" year="2023"/>
            <abstract>
              <t>Messaging applications are increasingly making use of end-to-end security mechanisms to ensure that messages are only accessible to the communicating endpoints, and not to any servers involved in delivering messages. Establishing keys to provide such protections is challenging for group chat settings, in which more than two clients need to agree on a key but may not be online at the same time. In this document, we specify a key establishment protocol that provides efficient asynchronous group key establishment with forward secrecy (FS) and post-compromise security (PCS) for groups in size ranging from two to thousands.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="9420"/>
          <seriesInfo name="DOI" value="10.17487/RFC9420"/>
        </reference>
        <reference anchor="RFC2119" xml:base="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml">
          <front>
            <title>Key words for use in RFCs to Indicate Requirement Levels</title>
            <author fullname="S. Bradner" initials="S." surname="Bradner"/>
            <date month="March" year="1997"/>
            <abstract>
              <t>In many standards track documents several words are used to signify the requirements in the specification. These words are often capitalized. This document defines these words as they should be interpreted in IETF documents. This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="14"/>
          <seriesInfo name="RFC" value="2119"/>
          <seriesInfo name="DOI" value="10.17487/RFC2119"/>
        </reference>
        <reference anchor="RFC8174" xml:base="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml">
          <front>
            <title>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</title>
            <author fullname="B. Leiba" initials="B." surname="Leiba"/>
            <date month="May" year="2017"/>
            <abstract>
              <t>RFC 2119 specifies common key words that may be used in protocol specifications. This document aims to reduce the ambiguity by clarifying that only UPPERCASE usage of the key words have the defined special meanings.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="14"/>
          <seriesInfo name="RFC" value="8174"/>
          <seriesInfo name="DOI" value="10.17487/RFC8174"/>
        </reference>
      </references>
      <references anchor="sec-informative-references">
        <name>Informative References</name>
        <reference anchor="I-D.mahy-mls-semiprivatemessage">
          <front>
            <title>Semi-Private Messages in the Messaging Layer Security (MLS) Protocol</title>
            <author fullname="Rohan Mahy" initials="R." surname="Mahy">
              <organization>Rohan Mahy Consulting Services</organization>
            </author>
            <date day="21" month="April" year="2025"/>
            <abstract>
              <t>   This document defines a SemiPrivateMessage for the Messaging Layer
   Security (MLS) protocol.  It allows members to share otherwise
   private commits and proposals with a designated list of external
   receivers rather than send these handshakes in a PublicMessage.

              </t>
            </abstract>
          </front>
          <seriesInfo name="Internet-Draft" value="draft-mahy-mls-semiprivatemessage-05"/>
        </reference>
        <reference anchor="I-D.ietf-mimi-protocol">
          <front>
            <title>More Instant Messaging Interoperability (MIMI) using HTTPS and MLS</title>
            <author fullname="Richard Barnes" initials="R." surname="Barnes">
              <organization>Cisco</organization>
            </author>
            <author fullname="Matthew Hodgson" initials="M." surname="Hodgson">
              <organization>The Matrix.org Foundation C.I.C.</organization>
            </author>
            <author fullname="Konrad Kohbrok" initials="K." surname="Kohbrok">
              <organization>Phoenix R&amp;D</organization>
            </author>
            <author fullname="Rohan Mahy" initials="R." surname="Mahy">
              <organization>Rohan Mahy Consulting Services</organization>
            </author>
            <author fullname="Travis Ralston" initials="T." surname="Ralston">
              <organization>The Matrix.org Foundation C.I.C.</organization>
            </author>
            <author fullname="Raphael Robert" initials="R." surname="Robert">
              <organization>Phoenix R&amp;D</organization>
            </author>
            <date day="7" month="July" year="2025"/>
            <abstract>
              <t>   This document specifies the More Instant Messaging Interoperability
   (MIMI) transport protocol, which allows users of different messaging
   providers to interoperate in group chats (rooms), including to send
   and receive messages, share room policy, and add participants to and
   remove participants from rooms.  MIMI describes messages between
   providers, leaving most aspects of the provider-internal client-
   server communication up to the provider.  MIMI integrates the
   Messaging Layer Security (MLS) protocol to provide end-to-end
   security assurances, including authentication of protocol
   participants, confidentiality of messages exchanged within a room,
   and agreement on the state of the room.

              </t>
            </abstract>
          </front>
          <seriesInfo name="Internet-Draft" value="draft-ietf-mimi-protocol-04"/>
        </reference>
      </references>
    </references>
    <?line 131?>

<section numbered="false" anchor="acknowledgments">
      <name>Acknowledgments</name>
      <t>TODO acknowledge.</t>
    </section>
  </back>
  <!-- ##markdown-source:
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

-->

</rfc>
